<!DOCTYPE html>
<html>

<head>
    <title>Code Labs Challenge</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div class="container">
        <h1>Number Search</h1>
        <div class="challenge-block">
            <h2>Description</h2>
        <p>Your program must take an input file, create an output file, and return the path to the newly created output file. Ensure the path to the input file is absolute and easily modifiable. <b>The input and output files must use Linux line endings (the line feed character: `\n`)</b>.
        </br></br>
            For each line of the input file:
            </p>
        <ul>
            <li>Identify the first number in the line</li>
            <li>Identify the last number in the line</li>
            <li>Combine these two numbers to form a two-digit number (if there is only a single number in a given line - use that number twice)</li>
            <li>Write this two-digit number to the new file</li>
        </ul>

        </div>

        <div class="challenge-block">
            <h2>Constraints</h2>
            <p>
                <li>There will be at least 1 line in each file</li>
                <li>There is no set limit to the number of lines in a file _(hint: expect very large files)_</li>
                <li>Each line will contain at least 1 number</li>
                <li>The maximum line length is 100\</li>
                <li>Alphanumeric only - no spaces or special characters</li>
            </p>
        </div>

        <div class="challenge-block">
            <h2>Scoring</h2>
            <p>
                <li>Solutions must pass all test cases (tests used for scoring will not be the same as the provided example)</li>
                <li>The program with the fastest execution time that passes all test cases is the winner</li>
            </p>
        </div>

        <div class="challenge-block">
            <h2>Example</h2>
            <pre>
            <code>
            <b>Input file:</b>
            g5t86aah32
            h7lmq9p
            3xk
            y1z4w8b
            n8v2a  
            
            <b>Output file:</b>
            52
            79
            33
            18
            82

            <b>Program output:</b>
            /home/user/output.txt

        </code>
        </pre>
        </div>

        <div class="challenge-block">
            <h2>Due Date</h2>
            <p>
                <li>All solutions must be submitted by September 1st at 23:59:59</li>
            </p>
        </div>
        
        <br><br>

        <form id="codeForm" enctype="multipart/form-data">
            <label for="name">Branch Name:</label>
            <input type="text" id="name" name="name" required><br><br>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required><br>
            <select id="repo" name="repo">
                <!-- REPONAME Option set from constant in SCRIPT below -->
            </select><br><br>
            <label for="commitMessage">Commit Message:</label>
            <input id="commitMessage" name="commitMessage" type="text" required><br><br>
            <label for="file">Upload File(s):</label>
            <input type="file" id="file" name="file" multiple required>
            <ul id="fileList"></ul>
            <input type="text" id="honeypot" name="honeypot" autocomplete="off" >
            <button type="submit">Submit Solution</button>
        </form>

        <div id="feedback"">Uploading your awesome solution... Please wait.</div>
    </div>

    <script>
        // Name of repo where to push code
        const REPONAME = "number-search";

        document.addEventListener('DOMContentLoaded', () => {
            const repoSelect = document.getElementById('repo');
            const option = document.createElement('option');
            option.value = REPONAME;
            option.textContent = REPONAME;
            repoSelect.appendChild(option);


            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const commitMessageInput = document.getElementById('commitMessage');
            const submitButton = document.querySelector('button[type="submit"]');
            const feedback = document.getElementById('feedback');
            const fileInput = document.getElementById('file');
            const fileList = document.getElementById('fileList');

            // Disable submit button initially
            submitButton.disabled = true;

            // Load stored data
            nameInput.value = localStorage.getItem('name') || '';
            emailInput.value = localStorage.getItem('email') || '';

            // Function to check form validity
            const checkFormValidity = () => {
                const isFormValid = nameInput.value && emailInput.value && commitMessageInput.value && fileInput.files.length > 0;
                submitButton.disabled = !isFormValid;
            };

            // Store data on input change and check form validity
            nameInput.addEventListener('input', () => {
                localStorage.setItem('name', nameInput.value);
                checkFormValidity();
            });

            emailInput.addEventListener('input', () => {
                localStorage.setItem('email', emailInput.value);
                checkFormValidity();
            });

            commitMessageInput.addEventListener('input', () => {
                checkFormValidity();
            });

            // Display chosen files and check form validity
            fileInput.addEventListener('change', () => {
                fileList.innerHTML = '';
                const fileListContainer = document.createElement('div');
                fileListContainer.classList.add('file-list-container');

                const fileListElement = document.createElement('ul');
                fileListContainer.appendChild(fileListElement);

                for (let i = 0; i < fileInput.files.length; i++) {
                    const listItem = document.createElement('li');
                    listItem.textContent = fileInput.files[i].name;
                    fileListElement.appendChild(listItem);
                }

                fileInput.parentNode.insertBefore(fileListContainer, fileInput.nextSibling);

                checkFormValidity();
            });

            document.getElementById('codeForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                // Disable submit button and show feedback
                submitButton.disabled = true;
                feedback.classList.remove('hidden');

                const formData = new FormData(e.target);

                try {
                    const response = await fetch('https://4qhii2jyp2.execute-api.us-east-1.amazonaws.com/prod/submit', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        alert('Your submission has been submitted successfully!');
                    } else {
                        const errorText = await response.text();
                        console.error('Error response from server:', response.status, response.statusText, errorText);
                        alert('There was an error submitting your code.');
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                    alert('There was an error submitting your code.');
                }

                // Enable submit button and hide feedback after the response
                submitButton.disabled = false;
                feedback.classList.add('hidden'); 
            });
        });
    </script>
</body>

</html>